<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Passport Photo Maker - Printable 8 Photos on 6x4 Page with 30px Gaps</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: #f9fafb;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    color: #374151;
  }
  header {
    background: white;
    padding: 1rem 2rem;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    font-weight: 700;
    font-size: 1.5rem;
    letter-spacing: 0.03em;
    user-select: none;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  main {
    flex: 1;
    max-width: 900px;
    margin: 2rem auto 3rem;
    padding: 0 1rem;
  }
  .upload-section {
    margin-bottom: 2rem;
  }
  label.upload-label {
    display: inline-flex;
    align-items: center;
    background: #4f46e5;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  label.upload-label:hover {
    background: #4338ca;
  }
  input[type="file"] {
    display: none;
  }
  .canvas-container {
    position: relative;
    overflow-x: auto;
    max-width: 100%;
    background: white;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgb(0 0 0 / 0.1);
    padding: 1rem;
  }
  canvas {
    max-width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    background: white;
  }
  .btn-group {
    margin-top: 1.5rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  button.download-btn {
    cursor: pointer;
    font-weight: 600;
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    color: white;
    background-image: linear-gradient(45deg, #4f46e5, #06b6d4);
    transition: background-image 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  button.download-btn:hover {
    background-image: linear-gradient(45deg, #4338ca, #0d9488);
  }
  button.download-btn .material-icons {
    font-size: 20px;
  }
  .note {
    font-size: 0.9rem;
    color: #6b7280;
    margin-top: 0.5rem;
  }
</style>
</head>
<body>
  <header>
    Passport Photo Maker - 8 Photos on 6×4 inch page with 30px Gaps
  </header>
  <main>
    <section class="upload-section">
      <label htmlFor="upload" class="upload-label" aria-label="Upload image to create passport photos">
        <span class="material-icons" aria-hidden="true">upload_file</span>
        Upload Image
        <input type="file" id="upload" accept="image/*" />
      </label>
      <p class="note">Upload a photo to crop to passport size. The app places 8 photos (1.5×2 inch approx.) with 3px black border and 30px white gaps around each photo on a 6×4 inch page (landscape) for printing and cutting.</p>
    </section>
    <section class="canvas-container" aria-label="Passport photo preview and download area">
      <canvas id="photo-canvas" width="1800" height="1200" aria-label="Generated 6 by 4 inch page with 8 passport photos"></canvas>
    </section>
    <div class="btn-group" role="group" aria-label="Download options">
      <button id="download-png" class="download-btn" disabled aria-disabled="true" aria-label="Download image as PNG">
        <span class="material-icons" aria-hidden="true">file_download</span>Download PNG
      </button>
      <button id="download-jpg" class="download-btn" disabled aria-disabled="true" aria-label="Download image as JPG">
        <span class="material-icons" aria-hidden="true">file_download</span>Download JPG
      </button>
    </div>
  </main>
  <script type="text/javascript">
    (() => {
      const DPI = 300;
      const photoWidthInch = 1.5;
      const photoHeightInch = 2.0;
      const pageWidthInch = 6; // landscape width
      const pageHeightInch = 4; // landscape height

      const pageWidthPx = Math.round(pageWidthInch * DPI); // 1800
      const pageHeightPx = Math.round(pageHeightInch * DPI); // 1200
      
      const borderPx = 3; // black border thickness (inside photo)

      // Gap of 30px
      const gapPx = 40;

      // Grid config: 4 columns × 2 rows
      const cols = 4;
      const rows = 2;

      // Total gaps horizontal and vertical (cols+1 and rows+1 gaps)
      const totalGapX = (cols + 1) * gapPx;
      const totalGapY = (rows + 1) * gapPx;

      // Photo box width and height including border (excluding gap)
      const photoBoxWidth = (pageWidthPx - totalGapX) / cols;
      const photoBoxHeight = (pageHeightPx - totalGapY) / rows;

      // Image size inside border
      const imageWidth = photoBoxWidth - 2 * borderPx;
      const imageHeight = photoBoxHeight - 2 * borderPx;

      const targetAspect = imageWidth / imageHeight; // aspect ratio for cropping

      const canvas = document.getElementById('photo-canvas');
      const ctx = canvas.getContext('2d');

      function clearCanvas() {
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, pageWidthPx, pageHeightPx);
      }

      function drawPhotoWithBorderAndGap(img, sx, sy, sWidth, sHeight, dx, dy, boxWidth, boxHeight) {
        // dx, dy include gapPx left and top for the photo box
        const borderX = dx + gapPx;
        const borderY = dy + gapPx;
        const borderWidth = boxWidth;
        const borderHeight = boxHeight;

        // Draw black border rect (photo box)
        ctx.fillStyle = 'black';
        ctx.fillRect(borderX, borderY, borderWidth, borderHeight);

        // Draw image inside border adjusted by border thickness
        ctx.drawImage(img, sx, sy, sWidth, sHeight,
          borderX + borderPx,
          borderY + borderPx,
          borderWidth - 2 * borderPx,
          borderHeight - 2 * borderPx);
      }

      function createCropArea(image) {
        const imgAspect = image.width / image.height;
        let sx, sy, sWidth, sHeight;

        if (imgAspect > targetAspect) {
          sHeight = image.height;
          sWidth = sHeight * targetAspect;
          sx = (image.width - sWidth) / 2;
          sy = 0;
        } else {
          sWidth = image.width;
          sHeight = sWidth / targetAspect;
          sx = 0;
          sy = (image.height - sHeight) / 2;
        }
        return { sx, sy, sWidth, sHeight };
      }

      function drawAllPhotos(img) {
        clearCanvas();

        const crop = createCropArea(img);

        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const dx = c * (photoBoxWidth + gapPx);
            const dy = r * (photoBoxHeight + gapPx);

            drawPhotoWithBorderAndGap(
              img,
              crop.sx,
              crop.sy,
              crop.sWidth,
              crop.sHeight,
              dx,
              dy,
              photoBoxWidth,
              photoBoxHeight
            );
          }
        }
      }

      function downloadCanvas(format) {
        let dataUrl;
        if(format === 'png') {
          dataUrl = canvas.toDataURL('image/png');
        } else if(format === 'jpg') {
          dataUrl = canvas.toDataURL('image/jpeg', 0.92);
        }

        const link = document.createElement('a');
        link.href = dataUrl;
        link.download = `passport_photos.${format}`;
        document.body.appendChild(link);
        link.click();
        link.remove();
      }

      const uploadInput = document.getElementById('upload');
      const btnDownloadPNG = document.getElementById('download-png');
      const btnDownloadJPG = document.getElementById('download-jpg');

      let uploadedImage = null;

      uploadInput.addEventListener('change', e => {
        const file = e.target.files[0];
        if(!file) return;

        if(!file.type.startsWith('image/')) {
          alert('Please upload a valid image file.');
          return;
        }
        
        const img = new Image();
        const url = URL.createObjectURL(file);
        img.onload = () => {
          uploadedImage = img;
          drawAllPhotos(img);
          btnDownloadPNG.disabled = false;
          btnDownloadJPG.disabled = false;
          btnDownloadPNG.setAttribute('aria-disabled', 'false');
          btnDownloadJPG.setAttribute('aria-disabled', 'false');
          URL.revokeObjectURL(url);
        };
        img.onerror = () => {
          alert('Failed to load the image. Please try another file.');
          URL.revokeObjectURL(url);
          uploadedImage = null;
          clearCanvas();
          btnDownloadPNG.disabled = true;
          btnDownloadJPG.disabled = true;
          btnDownloadPNG.setAttribute('aria-disabled', 'true');
          btnDownloadJPG.setAttribute('aria-disabled', 'true');
        };
        img.src = url;
      });

      btnDownloadPNG.addEventListener('click', () => {
        if(uploadedImage) {
          downloadCanvas('png');
        }
      });
      btnDownloadJPG.addEventListener('click', () => {
        if(uploadedImage) {
          downloadCanvas('jpg');
        }
      });

      clearCanvas();
    })();
  </script>
</body>
</html>

